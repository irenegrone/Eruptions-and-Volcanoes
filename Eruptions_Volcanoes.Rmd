---
title: "Eruptions and Volcanoes"
author: Irene Grone
output: 
  flexdashboard::flex_dashboard:
    theme: 
      bg: "darkgrey"
      fg: "black"
      primary: "#8AD4C0"
      secondary: "lightblue"
      navbar-bg: "#FFB46E"
    orientation: rows
    vertical_layout: fill
    navbar:
      - { title: "Profile", 
          href: "http://www.linkedin.com/in/irenegrone", 
          align: right, icon: fa-linkedin }
      - { title: "Code", 
          href: "https://github.com/irenegrone", 
          align: right, icon: fa-github }
---


```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(stringr)
library(purrr)
library(readxl)
library(magrittr)
library(lubridate)
library(ggplot2)
library(flexdashboard)
library(leaflet)


# File paths
Eruption_FILE_PATH = "data/GVP_Eruption_Results.xlsx"
Holocene_FILE_PATH = "data/GVP_Volcano_List_Holocene.xlsx"
Pleistocene_FILE_PATH = "data/GVP_Volcano_List_Pleistocene.xlsx"

# Eruptions ####
eruption_data <- read_xlsx(Eruption_FILE_PATH,
                           sheet = "Eruption List",
                           skip = 1)[, c("Volcano Number",
                                         "Volcano Name",
                                         "Eruption Number",
                                         "VEI",
                                         "Start Year",
                                         "Start Month",
                                         "Evidence Method (dating)",
                                         "Latitude",
                                         "Longitude")]

names(eruption_data) <- str_to_lower(gsub(" ", "_", names(eruption_data)))


# missing start_month are replaced with month = 1
# missing VEI are replaced with rank unknown
eruption_data <- eruption_data %>%
  rename_at("evidence_method_(dating)", ~"evidence_method_dating") %>%
  mutate(
    vei = as.numeric(vei),
    start_year = as.numeric(start_year),
    start_month = as.numeric(start_month),
    evidence_method_dating = replace_na(evidence_method_dating, "unknown"),
    # assumption missing Explosivity Index are of rank 0
    vei = replace_na(vei, "unknown"),
    # missing `Start Month` are replaced with default 1
    start_month = replace_na(start_month, 1)
  ) %>%
  filter(!is.na(start_year)) %>%
  filter(volcano_name != "Unknown Source")


# Eruption events ####
events_data <- read_xlsx(Eruption_FILE_PATH,
                                  sheet = "Events",
                                  skip = 1)[, c("Volcano Number",
                                                "Volcano Name",
                                                "Eruption Number",
                                                "Eruption Start Year",
                                                "Event Number",
                                                "Event Type")]


names(events_data) <- str_to_lower(gsub(" ", "_", names(events_data)))


events_data <- events_data %>%
  mutate(
    eruption_start_year = as.numeric(eruption_start_year)
  ) %>%
  filter(volcano_name != "Unknown Source")


# Holocene ####
holocene <- read_xlsx(Holocene_FILE_PATH,
                                sheet = "Holocene Volcano List",
                                skip = 1)


names(holocene) <- str_to_lower(gsub(" ", "_", names(holocene)))


holocene <- holocene %>%
  rename_at("elevation_(m)", ~"elevation") %>%
  select(!c(last_known_eruption, activity_evidence)) %>%
  mutate(
    dominant_rock_type = replace_na(dominant_rock_type, "Unknown"),
    tectonic_setting = replace_na(tectonic_setting, "Unknown"),
    primary_volcano_type = gsub("\\(es\\)", "", primary_volcano_type),
    primary_volcano_type = gsub("\\(s\\)", "", primary_volcano_type),
    primary_volcano_type = gsub("\\?", "", primary_volcano_type),
    primary_volcano_type = str_trim(primary_volcano_type),
  )


# Pleistocene ####
pleistocene <- read_xlsx(Pleistocene_FILE_PATH,
                         sheet = "Pleistocene Volcano List",
                         skip = 1)[ , c("Volcano Number",
                                        "Volcano Name",
                                        "Country",
                                        "Primary Volcano Type",
                                        "Region",
                                        "Subregion",
                                        "Latitude",
                                        "Longitude",
                                        "Elevation (m)",
                                        "Tectonic Setting")]


names(pleistocene) <- str_to_lower(gsub(" ", "_", names(pleistocene)))


pleistocene <- pleistocene %>%
  rename_at("elevation_(m)", ~"elevation") %>%
  mutate(
    tectonic_setting = replace_na(tectonic_setting, "Unknown"),
    primary_volcano_type = gsub("\\(es\\)", "", primary_volcano_type),
    primary_volcano_type = gsub("\\(s\\)", "", primary_volcano_type),
    primary_volcano_type = gsub("\\(\\?\\)", "", primary_volcano_type),
    primary_volcano_type = gsub("\\?", "", primary_volcano_type),
    primary_volcano_type = str_trim(primary_volcano_type),
  )
```




Volcanoes Map {data-icon="fa-globe"}
=====================================

### <b><font size=12>Volcanoes in the World</font></b>
```{r}
holo_coord <- holocene %>%
  select(volcano_number, volcano_name, latitude, longitude,
         primary_volcano_type, tectonic_setting, elevation) %>%
  mutate(
    era = "Holocene"
  )


plei_coord <- pleistocene %>%
  select(volcano_number, volcano_name, latitude, longitude,
         primary_volcano_type, tectonic_setting, elevation) %>%
  mutate(
    era = "Pleistocene"
  )


volcanoes_geo <- 
  holo_coord %>%
  union(plei_coord) %>%
  mutate(
    primary_volcano_type = as.factor(primary_volcano_type),
    tectonic_setting = as.factor(tectonic_setting),
    era = as.factor(era)
  )


leaflet(volcanoes_geo,  padding = 10) %>%
  addTiles() %>%
  setView(lng = -0, lat = 0, zoom = 1.5) %>%
  addCircleMarkers(lng = ~longitude,
                  lat = ~latitude,
                  radius = 1,
                  color = ifelse(volcanoes_geo$era == "Holocene",
                                 "darkgreen", "royalblue"),
                  ) %>%
  addLegend("bottomright", 
            colors = c("darkgreen", "royalblue"),
            labels = c("Holocene", "Pleistocene"),
            title = "Era"
            )
```



Holocene 
=====================================


Value Boxes {data-width=200}
-------------------------------------

### Holocene

```{r}
cnt_holo <- length(unique(holocene$volcano_number))

valueBox(cnt_holo, caption = "HOLOCENE VOLCANOES")
```

### primary_volcano_type

```{r}
cnt_type <- length(unique(holocene$primary_volcano_type))

valueBox(cnt_type, caption = "PRIMARY VOLCANO TYPE", color = "#AD80C4")
```


### country

```{r}
cnt_country <- length(unique(holocene$country))

valueBox(cnt_country, caption = "COUNTRIES", color = "#79BEE0")
```


Row {data-height=600, data-width=700}
-----------------------------------------------------------------------

### PRIMARY VOLCANO TYPE

```{r, fig.width = 6, fig.height= 5}
volcanoes_geo %>%
  filter(era == "Holocene") %>%
  group_by(primary_volcano_type) %>%
  summarise(
    cnt = n()
  ) %>%
  ggplot(aes(x = primary_volcano_type,
             y = cnt)
         ) +
  geom_bar(position="stack", stat="identity", fill = "darkgreen") +
  geom_text(aes(label=cnt), vjust = -0.2, color = "black", size = 3) +
  ylim(0, 710) +
  labs(
    x = "Volcano type",
    y = "Count",
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1, vjust = 1),
        legend.position = "none")
```


### TOP 20 COUNTRIES
```{r}

```
> Caption


Row {data-height=400}
-----------------------------------------------------------------------


### Chart A.2

### Chart A.3

### Description
Some text that explain





Pleistocene
=====================================


Value Boxes {data-width=200}
-------------------------------------

### Pleistocene
```{r}
cnt_plei <- length(unique(pleistocene$volcano_number))

valueBox(cnt_plei, caption = "PLEISTOCENE VOLCANOES")
```

### primary_volcano_type

```{r}
cnt_plei_type <- length(unique(pleistocene$primary_volcano_type))

valueBox(cnt_plei_type, caption = "PRIMARY VOLCANO TYPE", color = "#AD80C4")
```


### country

```{r}
cnt_plei_country <- length(unique(pleistocene$country))

valueBox(cnt_plei_country, caption = "COUNTRIES", color = "#79BEE0")
```


Row {data-height=600, data-width=700}
-----------------------------------------------------------------------

### PRIMARY VOLCANO TYPE

```{r, fig.width = 6, fig.height= 5}
volcanoes_geo %>%
  filter(era == "Pleistocene") %>%
  group_by(primary_volcano_type) %>%
  summarise(
    cnt = n()
  ) %>%
  ggplot(aes(x = primary_volcano_type,
             y = cnt)
  ) +
  geom_bar(position="stack", stat="identity", fill = "royalblue") +
  geom_text(aes(label=cnt), vjust = -0.2, color = "black", size = 3) +
  ylim(0, 710) +
  labs(
    x = "Volcano type",
    y = "Count",
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1, vjust = 1),
        legend.position = "none")
```



### Description
Some text that explain



Row {data-width=400}
-----------------------------------------------------------------------

### <b>ELEVATION</b>


```{r}

```


Eruptions
=====================================

### Chart C

```{r}

```





{data-icon="fa-info-circle"}
=====================================


Row {data-height=200}
-------------------------------------

### <b><font size=12>About</font></b>

Volcanoes and eruptions are a fascinating and very interesting subject and the Smithsonian Institution (see Data section below) provide a well maintained and updated database open to the public and researchers.

This dashboard has been created as part of a data science / analytics portfolio (see github repository for code from link on top right of page). The aim of the repository is to practice visualisation with Flexdashboard on open source data.


Row 
-------------------------------------

### <b><font size=12>Data</font></b>

The data from Smithsonian Institution are available for use with the [CC0 1.0 Universal licence](https://creativecommons.org/publicdomain/zero/1.0/)
and follow the Smithsonian term of use available at https://www.si.edu/termsofuse


GVP_Volcano_List_Holocene.xlsx<br>
<cite>Global Volcanism Program, 2013. Volcanoes of the World, v. 4.9.4. Venzke, E (ed.). Smithsonian Institution. Downloaded 10 May 2021. https://doi.org/10.5479/si.GVP.VOTW4-2013 <br>
downloaded at https://volcano.si.edu/list_volcano_holocene.cfm </cite>


GVP_Volcano_List_Pleistocene<br>
<cite>Global Volcanism Program, 2013. Volcanoes of the World, v. 4.9.4. Venzke, E (ed.). Smithsonian Institution. Downloaded 10 May 2021. https://doi.org/10.5479/si.GVP.VOTW4-2013 <br>
downloaded at  https://volcano.si.edu/list_volcano_pleistocene.cfm </cite>


GVP_Eruption_Results.xlsx<br>
<cite>Global Volcanism Program, 2013. Volcanoes of the World, v. 4.9.4. Venzke, E (ed.). Smithsonian Institution. Downloaded 10 May 2021. https://doi.org/10.5479/si.GVP.VOTW4-2013 <br>
downloaded at https://volcano.si.edu/database/search_eruption_results.cfm </cite>
